(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{activate:()=>O,deactivate:()=>S,showHomeHandler:()=>k,webviewMessageHandler:()=>j});const o=require("vscode"),n=require("path");var i=e.n(n);const s=require("fs");var r=e.n(s);const c=require("util"),l=require("child_process");var a,d=o.window.showErrorMessage;o.window.showInformationMessage,c.promisify(l.exec),function(e){e.success="0",e.failed="1"}(a||(a={}));var u=function(e,t){try{return s.writeFileSync(e,t),a.success}catch(e){return d(String(e)),a.failed}};function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){p(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function f(){var e,t=null===(e=o.workspace.workspaceFolders)||void 0===e?void 0:e.map((function(e){return e.uri.path}));return t&&(null==t?void 0:t.length)>0?t[0]:""}const g="module.exports = {\n    extends: ['@ad/eslint-config-ad/typescript/react'],\n    parserOptions: {\n        project: './tsconfig.json',\n        createDefaultProgram: true,\n        extraFileExtensions: ['.vue'],\n        tsconfigRootDir: __dirname,\n    },\n};";function m(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function y(e){return function t(o){return 0===arguments.length||m(o)?t:e.apply(this,arguments)}}const b=y((function(e){return null==e}));var w=function(e,t,o,n){return new(o||(o=Promise))((function(i,s){function r(e){try{l(n.next(e))}catch(e){s(e)}}function c(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,c)}l((n=n.apply(e,t||[])).next())}))};const F=()=>{const e=r().readdirSync(i().resolve(f())).join("|");return{eslint:e.includes(".eslintrc"),prettier:e.includes(".prettierrc"),commitlint:e.includes(".commitlintrc"),stylelint:e.includes(".stylelintrc"),npmPackage:e.includes("package.json")}},j=(e,t)=>w(void 0,void 0,void 0,(function*(){if("lint"!==e.channel)return;const o=f();switch(e.method){case"installLint":n=`cd ${o} && ${e.value}`,i=e=>console.log(e),s=e=>console.warn(e),c=n=>{u(`${o}/.eslintrc.js`,g),u(`${o}/.eslintignore`,"node_modules\n*.log\nbuild\ndist\npublic\n/.vscode\n/.idea"),u(`${o}/.commitlintrc.js`,"module.exports = {\n    extends: ['@ad/commitlint-config-ad'],\n};"),u(`${o}/.stylelintrc.js`,"module.exports = {\n    extends: '@ad/stylelint-config-ad',\n};"),u(`${o}/.stylelintignore`,"node_modules\n*.log\nbuild\ndist\npublic"),u(`${o}/.prettierrc.js`,"module.exports = {\n    printWidth: 100,\n    tabWidth: 4,\n    semi: true,\n    singleQuote: true,\n    trailingComma: 'all',\n    arrowParens: 'always',\n};"),t.postMessage({channel:e.channel,method:e.method,value:n}),t.postMessage({channel:"lint",method:"initMessage",value:F()})},null===(a=(p=l.spawn(n,{shell:!0})).stdout)||void 0===a||a.on("data",(function(e){i&&i(e.toString())})),null===(d=p.stderr)||void 0===d||d.on("data",(function(e){s&&s(e.toString())})),p.on("close",(function(e){console.log("command ".concat(n,"; child process exited with code ").concat(null==e?void 0:e.toString())),c&&c(e)}));break;case"setAllLintConf":u(`${o}/.eslintrc.js`,g),t.postMessage({channel:e.channel,method:e.method,value:0});break;case"setBaseLintConf":u(`${o}/.eslintrc.js`,"module.exports = {\n    extends: [\n        '@ad/eslint-config-ad/typescript/react/base',    \n    ],\n    parserOptions: {\n        project: './tsconfig.json', \n        createDefaultProgram: true,\n        extraFileExtensions: ['.vue'],\n        tsconfigRootDir: __dirname,\n    },\n};"),t.postMessage({channel:e.channel,method:e.method,value:0});break;case"setVscodeConf":r().existsSync(`${o}/.vscode`)||r().mkdirSync(`${o}/.vscode`),u(`${o}/.vscode/settings.json`,'{\n    "eslint.validate": ["javascript", "javascriptreact", "typescript", "typescriptreact", "vue"],\n    "stylelint.validate": ["css", "less", "sass", "scss"],\n    "editor.codeActionsOnSave": {\n      "source.fixAll.eslint": true,\n      "source.fixAll.stylelint": true,\n      "source.fixAll.markdownlint": true\n    },\n    "editor.formatOnSave": true,\n    "[javascript]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[javascriptreact]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[typescript]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[typescriptreact]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[vue]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[html]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[json]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    },\n    "[jsonc]": {\n      "editor.defaultFormatter": "esbenp.prettier-vscode"\n    }\n}'),t.postMessage({channel:e.channel,method:e.method,value:0})}var n,i,s,c,a,d,p})),k=(e,t)=>w(void 0,void 0,void 0,(function*(){console.log("ksUserInfo:"),console.log(t),function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{initMessageToWbeview:{channel:"",method:"",value:{}}},s=o.window.createWebviewPanel(e,e,o.ViewColumn.One,v({enableScripts:!0},i));s.webview.onDidReceiveMessage((function(e){n(e,s.webview)})),s.webview.html=t,i.initMessageToWbeview&&s.webview.postMessage(i.initMessageToWbeview)}("lint 配置",(e=>{const t=JSON.parse(function(e){try{return s.readFileSync(e).toString()}catch(e){return d(String(e)),a.failed}}(i().join(e.path,"dist/ui/lint/asset-manifest.json"))),n=t.files["main.js"],r=t.files["main.css"],c=o.Uri.file(i().join(e.path,"dist/ui/lint",n)).with({scheme:"vscode-resource"}),l=o.Uri.file(i().join(e.path,"dist/ui/lint",r)).with({scheme:"vscode-resource"}),u=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<32;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}();return`<!DOCTYPE html>\n\t\t<html lang="en">\n\t\t\t<head>\n\t\t\t\t<meta charset="UTF-8">\n\n\t\t\t\t\x3c!--\n\t\t\t\t\tUse a content security policy to only allow loading images from https or from our extension directory,\n\t\t\t\t\tand only allow scripts that have a specific nonce.\n\t\t\t\t--\x3e\n\t\t\t\t<meta content="default-src 'none'; script-src 'nonce-${u}';">\n\n\t\t\t\t<meta name="viewport" content="width=device-width, initial-scale=1.0">\n\n\t\t\t\t<link href="${l}" rel="stylesheet">\n\t\t\t\t<base href="${o.Uri.file(i().join(e.path,"build")).with({scheme:"vscode-resource"})}/">\n\t\t\t\t\n\t\t\t\t<title>kcfe</title>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<noscript>You need to enable JavaScript to run this app.</noscript>\n\t\t\t\t<div id="root"></div>\n\t\t\t</body>\n\t\t\t<script nonce="${u}" src="${c}"><\/script>\n\t\t</html>`})(e),j,{retainContextWhenHidden:!0,initMessageToWbeview:{channel:"lint",method:"initMessage",value:t}})}));let x;function O(e){console.log('Congratulations, your extension "lint" is now active!');let t=null;x=o.commands.registerCommand("lint.show",(()=>w(this,void 0,void 0,(function*(){var n;console.log("获取sso插件");let i=o.extensions.getExtension("Kcfe.sso");console.log(i);let s=null==i?void 0:i.exports;if(console.log("获取的sso-api:"),console.log(s),yield s.logout(),yield s.isLogin()){console.log("已经登录"),t=yield s.getUserInfo();const o=yield s.getCookie("doc","https://sso.corp.kuaishou.com/cas/login?service=https%3A%2F%2Fdocs.corp.kuaishou.com%2Fmerlot%2Flogin%2Fcas%3Fredirect_url%3Dhttps%253A%252F%252Fdocs.corp.kuaishou.com%252Fhome");console.log("docCookie:",o);const i=yield s.getCookie("halo","https://sso.corp.kuaishou.com/cas/login?service=https%3A%2F%2Fhalo.corp.kuaishou.com%2Fcas%3Fnext%3Dhttps%253A%252F%252Fhalo.corp.kuaishou.com%252F#/");if(console.log("haloCookie:",i),yield e.globalState.update("ksUserInfo",t),console.log("showHomeHandler前",t),!b(null===(n=e.globalState.get("ksUserInfo"))||void 0===n?void 0:n.userId))return console.log("已登录打开home"),k(e.extensionUri,t),void(yield s.hideSsoWebview())}else console.log("未登录!!!!!!"),yield s.showSsoWebview(),yield s.onLogin("doc","https://sso.corp.kuaishou.com/cas/login?service=https%3A%2F%2Fdocs.corp.kuaishou.com%2Fmerlot%2Flogin%2Fcas%3Fredirect_url%3Dhttps%253A%252F%252Fdocs.corp.kuaishou.com%252Fhome",((o,n)=>w(this,void 0,void 0,(function*(){var i;if(console.log("userInfo: ",n),console.log(typeof n),console.log(n),console.log("cookie:"),console.log(o),t=n,console.log("onLogin"),yield e.globalState.update("ksUserInfo",t),!b(null===(i=e.globalState.get("ksUserInfo"))||void 0===i?void 0:i.userId)){console.log("ssoapi getCookie前",t);const o=yield s.getCookie("halo","https://sso.corp.kuaishou.com/cas/login?service=https%3A%2F%2Fhalo.corp.kuaishou.com%2Fcas%3Fnext%3Dhttps%253A%252F%252Fhalo.corp.kuaishou.com%252F#/");return console.log("haloCookie:",o),k(e.extensionUri,t),void(yield s.hideSsoWebview())}}))))})))),e.subscriptions.push(x)}function S(){x.dispose()}module.exports=t})();